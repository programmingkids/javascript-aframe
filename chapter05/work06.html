<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>work06</title>
<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
<body>
<a-scene physics="gravity:-9.8; friction: 0.1; restitution: 0.8">
    <a-assets>
        <img id="ground" src="./../assets/floor-1024.jpg">
    </a-assets>
    <a-plane 
        src="#ground"
        scale="50 50 1"
        repeat="5 5 1"
        rotation="-90 0 0"
        static-body></a-plane>
    <a-box
        color="#cccccc"
        position="-8 3 0"
        scale="0.2 6 20"
        static-body></a-box>
    <a-box
        color="#cccccc"
        position="8 3 0"
        scale="0.2 6 20"
        static-body></a-box>
    <a-box
        color="#cccccc"
        position="0 3 -10"
        scale="16 6 0.2"
        static-body></a-box>
    <a-box
        color="#cccccc"
        position="0 3 10"
        scale="16 6 0.2"
        static-body></a-box>
    </a-sphere>
</a-scene>
<script>
window.onload = init;

var scene;
var minX = -7;
var maxX = 7;
var minZ = -9;
var maxZ = 9;
var minY = 3;
var maxY = 6;

function getRandomRange(min, max){
    return Math.floor(Math.random() * (max - min + 1) + min);
}

function getRandomColor() {
    return "#"+((1<<24)*Math.random()|0).toString(16);
}

function init() {
    scene = document.querySelector('a-scene');
    
    for(var i=0; i < 20; i++) {
        generateBall();
    }
}

function generateBall() {
    var x = getRandomRange(minX, maxX);
    var z = getRandomRange(minZ, maxZ);
    var y = getRandomRange(minY, maxY);
    var color = getRandomColor();
    
    var newBall = document.createElement("a-sphere"); 
    newBall.setAttribute("color",color);
    newBall.setAttribute("radius","0.2");
    newBall.setAttribute("position",`${x} ${y} ${z}`);
    newBall.setAttribute("dynamic-body",{mass:1});
    newBall.setAttribute("hoge",{});
    if(scene) {
        scene.appendChild(newBall);
    }
}

AFRAME.registerComponent("hoge",{
    init: function(){
        var el = this.el;
        //console.log("this is hoge init");
        this.el.addEventListener('loaded',function(){
            //console.log("this is hoge body-loaded");
            var body = el.body;
            body.wakeUp();
            
            var x = getRandomRange(-2, 2);
            var z = getRandomRange(-2, 2);

            body.velocity.set(x, 5, z);
        });
    },
});
</script>
</body>
</html>
